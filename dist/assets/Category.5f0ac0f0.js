import"./vendor.3b4a458a.js";/* empty css             *//* empty css               *//* empty css              */import{r as e,v as a,g as t,o as r,c as l,w as o,a as n,f as i,q as s,s as c,K as d,h as p,i as u,l as g,j as m,L as y,x as f,d as v,U as b,e as h,M as k,N as _,O as C,P as x,E as I,R as F,S as j,T as L}from"./index.5a9a60f4.js";/* empty css                  *//* empty css                     *//* empty css                 *//* empty css                   *//* empty css                *//* empty css                  */const S={class:"dialog-footer"},w={__name:"DialogAddCategory",props:{type:String,reload:Function},setup(f,{expose:v}){const b=f,h=e(null),k=a(),_=t({visible:!1,categoryLevel:1,parentId:0,ruleForm:{name:"",rank:""},rules:{name:[{required:"true",message:"名称不能为空",trigger:["change"]}],rank:[{required:"true",message:"编号不能为空",trigger:["change"]}]},id:""}),C=()=>{h.value.validate((e=>{e&&("add"==b.type?c.post("/categories",{categoryLevel:_.categoryLevel,parentId:_.parentId,categoryName:_.ruleForm.name,categoryRank:_.ruleForm.rank}).then((()=>{d.success("添加成功"),_.visible=!1,b.reload&&b.reload()})):c.put("/categories",{categoryId:_.id,categoryLevel:_.categoryLevel,parentId:_.categoryLevel,categoryName:_.ruleForm.name,categoryRank:_.ruleForm.rank}).then((()=>{d.success("修改成功"),_.visible=!1,b.reload&&b.reload()})))}))};return v({open:e=>{if(_.visible=!0,e)_.id=e,(e=>{c.get(`/categories/${e}`).then((e=>{_.ruleForm={name:e.categoryName,rank:e.categoryRank},_.parentId=e.parentId,_.categoryLevel=e.categoryLevel}))})(e);else{const{level:e=1,parent_id:a=0}=k.query;_.ruleForm={name:"",rank:""},_.parentId=a,_.categoryLevel=e}},close:()=>{_.visible=!1}}),(e,a)=>{const t=p,c=u,d=g,f=m,v=y;return r(),l(v,{title:"add"==_.type?"添加分类":"修改分类",modelValue:_.visible,"onUpdate:modelValue":a[3]||(a[3]=e=>_.visible=e),width:"400px"},{footer:o((()=>[n("span",S,[i(f,{onClick:a[2]||(a[2]=e=>_.visible=!1)},{default:o((()=>[s("取 消")])),_:1}),i(f,{type:"primary",onClick:C},{default:o((()=>[s("确 定")])),_:1})])])),default:o((()=>[i(d,{model:_.ruleForm,rules:_.rules,ref_key:"formRef",ref:h,"label-width":"100px",class:"good-form"},{default:o((()=>[i(c,{label:"商品名称",prop:"name"},{default:o((()=>[i(t,{type:"text",modelValue:_.ruleForm.name,"onUpdate:modelValue":a[0]||(a[0]=e=>_.ruleForm.name=e)},null,8,["modelValue"])])),_:1}),i(c,{label:"排序值",prop:"rank"},{default:o((()=>[i(t,{type:"number",modelValue:_.ruleForm.rank,"onUpdate:modelValue":a[1]||(a[1]=e=>_.ruleForm.rank=e)},null,8,["modelValue"])])),_:1})])),_:1},8,["model","rules"])])),_:1},8,["title","modelValue"])}}},V={class:"header"},z=["onClick"],P=["onClick"],T=n("a",{style:{cursor:"pointer"}},"删除",-1),q={__name:"Category",setup(p){const u=e(null),g=f(),y=a(),S=t({loading:!1,tableData:[],multipleSelection:[],total:0,currentPage:1,pageSize:10,type:"add",level:1,parent_id:0});v((()=>{N()})),b((()=>{console.log(S.pageSize)}));const q=g.afterEach((e=>{["category","level2","level3"].includes(e.name)&&N()}));h((()=>{q()}));const N=()=>{const{level:e=1,parent_id:a=0}=y.query;S.loading=!0,c.get("/categories",{params:{pageNumber:S.currentPage,pageSize:S.pageSize,categoryLevel:e,parentId:a}}).then((t=>{S.tableData=t.list,S.total=t.totalCount,S.currentPage=t.currPage,S.loading=!1,S.level=e,S.parentId=a}))},R=e=>{S.currentPage=e,N()},B=()=>{S.type="add",u.value.open()},D=e=>{S.multipleSelection=e},U=()=>{S.multipleSelection.length?c.delete("/categories",{data:{ids:S.multipleSelection.map((e=>e.categoryId))}}).then((()=>{d.success("删除成功"),N()})):d.error("请选择项")};return(e,a)=>{const t=m,p=k,y=_,f=C,v=x,b=I;return r(),l(b,{class:"category-container"},{header:o((()=>[n("div",V,[i(t,{type:"primary",icon:F(j),onClick:B},{default:o((()=>[s("增加")])),_:1},8,["icon"]),i(p,{title:"确定删除吗？",confirmButtonText:"确定",cancelButtonText:"取消",onConfirm:U},{reference:o((()=>[i(t,{type:"danger",icon:F(L)},{default:o((()=>[s("批量删除")])),_:1},8,["icon"])])),_:1})])])),default:o((()=>[i(f,{load:S.loading,ref:"multipleTable",data:S.tableData,"tooltip-effect":"dark",style:{width:"100%"},onSelectionChange:D},{default:o((()=>[i(y,{type:"selection",width:"55"}),i(y,{prop:"categoryName",label:"分类名称"}),i(y,{prop:"categoryRank",label:"排序值",width:"120"}),i(y,{prop:"createTime",label:"添加时间",width:"200"}),i(y,{label:"操作",width:"220"},{default:o((e=>[n("a",{style:{cursor:"pointer","margin-right":"10px"},onClick:a=>{return t=e.row.categoryId,S.type="edit",void u.value.open(t);var t}},"修改",8,z),n("a",{style:{cursor:"pointer","margin-right":"10px"},onClick:a=>(e=>{const a=e.categoryLevel+1;4!=a?g.push({name:`level${a}`,query:{level:a,parent_id:e.categoryId}}):d.error("没有下一级")})(e.row)},"下级分类",8,P),i(p,{title:"确定删除吗？",confirmButtonText:"确定",cancelButtonText:"取消",onConfirm:a=>{return t=e.row.categoryId,void c.delete("/categories",{data:{ids:[t]}}).then((()=>{d.success("删除成功"),N()}));var t}},{reference:o((()=>[T])),_:2},1032,["onConfirm"])])),_:1})])),_:1},8,["load","data"]),i(v,{background:"",layout:"prev, pager, next",total:S.total,"page-size":S.pageSize,"current-page":S.currentPage,onCurrentChange:R},null,8,["total","page-size","current-page"]),i(w,{ref_key:"addCate",ref:u,reload:N,type:S.type},null,8,["type"])])),_:1})}}};export{q as default};
